# تدفق المصادقة والتسجيل - LUXBYTE

## نظرة عامة
تم تحديث تدفق المصادقة ليتطابق مع المتطلبات المطلوبة:

### 1. تسجيل حساب جديد
**الصفحة:** `simple-signup.html`

**التدفق:**
1. المستخدم يملأ البيانات الأساسية:
   - نوع الحساب (صيدلية، سوبر ماركت، مطعم، عيادة، سائق توصيل، سائق رئيسي)
   - الاسم الأول واسم العائلة
   - البريد الإلكتروني
   - رقم الهاتف
   - كلمة المرور وتأكيدها
   - الموافقة على الشروط والأحكام

2. عند الضغط على "إنشاء الحساب":
   - يتم إنشاء الحساب في Supabase
   - يتم إرسال رابط التحقق إلى البريد الإلكتروني
   - يتم توجيه المستخدم إلى صفحة تأكيد الإيميل

### 2. تأكيد الإيميل
**الصفحة:** `email-confirmation.html`

**التدفق:**
1. المستخدم يفتح الرابط المرسل إليه في البريد الإلكتروني
2. يتم تأكيد الإيميل تلقائياً
3. يتم توجيه المستخدم إلى صفحة استكمال التسجيل

### 3. استكمال التسجيل
**الصفحة:** `complete-registration.html`

**التدفق:**
1. المستخدم يملأ بيانات الموقع:
   - المحافظة
   - المدينة/الحي
   - العنوان التفصيلي
   - رابط خرائط جوجل (اختياري)
   - مواعيد العمل (اختياري)

2. المستخدم يرفع المستندات المطلوبة:
   - بطاقة الهوية (وجه وظهر)
   - عقد المقر
   - إيصال مرافق حديث
   - صور المكان (واجهة، داخلية، شخصية)
   - مستندات إضافية حسب نوع النشاط

3. عند الضغط على "إكمال التسجيل":
   - يتم رفع المستندات إلى Supabase Storage
   - يتم حفظ البيانات في قاعدة البيانات
   - يتم توجيه المستخدم إلى صفحة تسجيل الدخول

### 4. تسجيل الدخول
**الصفحة:** `auth.html`

**التدفق:**
1. المستخدم يدخل البريد الإلكتروني وكلمة المرور
2. عند تسجيل الدخول بنجاح:
   - يتم التحقق من اكتمال التسجيل
   - إذا لم يكتمل: يتم توجيهه لصفحة استكمال التسجيل
   - إذا اكتمل: يتم توجيهه للداشبورد المناسب

### 5. إعادة تعيين كلمة المرور
**الصفحة:** `reset-password.html`

**التدفق:**
1. المستخدم يطلب إعادة تعيين كلمة المرور من صفحة تسجيل الدخول
2. يتم إرسال رابط إعادة التعيين إلى البريد الإلكتروني
3. المستخدم يفتح الرابط ويدخل كلمة المرور الجديدة
4. يتم التحقق من تطابق كلمات المرور
5. عند النجاح: يتم توجيه المستخدم إلى صفحة تسجيل الدخول

## مسارات الكول باك

تم إعداد مسارات الكول باك التالية في Supabase:

- **تأكيد الإيميل:** `https://luxbyte.vercel.app/email-confirmation.html`
- **إعادة تعيين كلمة المرور:** `https://luxbyte.vercel.app/reset-password.html`
- **نجاح تسجيل الدخول:** `https://luxbyte.vercel.app/auth-success.html`
- **استكمال التسجيل:** `https://luxbyte.vercel.app/complete-registration.html`

## أنواع الحسابات والداشبوردات

| نوع الحساب | مسار الداشبورد |
|------------|----------------|
| pharmacy | `dashboard/pharmacy.html` |
| supermarket | `dashboard/supermarket.html` |
| restaurant | `dashboard/restaurant.html` |
| clinic | `dashboard/clinic.html` |
| courier | `dashboard/courier.html` |
| driver | `dashboard/driver.html` |
| admin | `dashboard.html` |

## الملفات المحدثة

### ملفات HTML جديدة:
- `simple-signup.html` - صفحة التسجيل المبسطة
- `complete-registration.html` - صفحة استكمال التسجيل
- `email-confirmation.html` - صفحة تأكيد الإيميل
- `reset-password.html` - صفحة إعادة تعيين كلمة المرور
- `auth-success.html` - صفحة نجاح تسجيل الدخول

### ملفات JavaScript محدثة:
- `js/auth-config.js` - إعدادات المصادقة ومسارات الكول باك
- `js/auth.js` - دوال المصادقة المحدثة
- `js/supabase-client.js` - عميل Supabase

### ملفات Supabase محدثة:
- `supabase/config.toml` - إعدادات مسارات الكول باك
- `supabase/migrations/` - هجرات قاعدة البيانات

## الأمان

- تم تفعيل تأكيد الإيميل في Supabase
- تم إعداد Row Level Security (RLS) للمستندات
- تم إعداد bucket منفصل للمستندات (`kyc_docs`)
- تم التحقق من صحة الملفات (JPG/PNG فقط)
- تم تحديد حد أقصى لحجم الملفات (5MB)

## الاختبار

لاختبار التدفق:
1. اذهب إلى `simple-signup.html`
2. املأ البيانات وأنشئ حساب
3. تحقق من البريد الإلكتروني
4. افتح رابط التحقق
5. أكمل رفع المستندات
6. سجل الدخول واختبر التوجيه للداشبورد
