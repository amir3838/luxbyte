# LUXBYTE - نظام المصادقة والتسجيل

## نظرة عامة
تم تطوير نظام مصادقة شامل ومتكامل لمنصة LUXBYTE يتضمن:

- تسجيل حسابات جديدة مع تأكيد الإيميل
- تسجيل الدخول مع التوجيه التلقائي للداشبورد المناسب
- إعادة تعيين كلمة المرور
- رفع المستندات المطلوبة لإكمال التسجيل
- نظام حماية متقدم للصفحات

## الميزات الرئيسية

### 1. تسجيل الحسابات
- **صفحة مبسطة:** `simple-signup.html`
- **البيانات المطلوبة:**
  - نوع الحساب (صيدلية، سوبر ماركت، مطعم، عيادة، سائق توصيل، سائق رئيسي)
  - الاسم الأول واسم العائلة
  - البريد الإلكتروني
  - رقم الهاتف
  - كلمة المرور مع التحقق من القوة
  - الموافقة على الشروط والأحكام

### 2. تأكيد الإيميل
- **صفحة تأكيد:** `email-confirmation.html`
- **الوظائف:**
  - تأكيد تلقائي للإيميل
  - توجيه لصفحة استكمال التسجيل
  - رسائل خطأ واضحة

### 3. استكمال التسجيل
- **صفحة الاستكمال:** `complete-registration.html`
- **البيانات المطلوبة:**
  - الموقع التفصيلي (المحافظة، المدينة، العنوان)
  - رفع المستندات المطلوبة (JPG/PNG فقط)
  - مستندات إضافية حسب نوع النشاط

### 4. تسجيل الدخول
- **صفحة تسجيل الدخول:** `auth.html`
- **الوظائف:**
  - تسجيل الدخول بالبريد الإلكتروني وكلمة المرور
  - التوجيه التلقائي للداشبورد المناسب
  - إعادة تعيين كلمة المرور

### 5. إعادة تعيين كلمة المرور
- **صفحة إعادة التعيين:** `reset-password.html`
- **الوظائف:**
  - إدخال كلمة مرور جديدة
  - تأكيد كلمة المرور
  - التحقق من تطابق كلمات المرور

## التدفق الكامل

```
1. المستخدم يزور simple-signup.html
   ↓
2. يملأ البيانات الأساسية ويضغط "إنشاء الحساب"
   ↓
3. يتم إرسال رابط التحقق إلى البريد الإلكتروني
   ↓
4. المستخدم يفتح الرابط في email-confirmation.html
   ↓
5. يتم تأكيد الإيميل تلقائياً
   ↓
6. يتم توجيه المستخدم إلى complete-registration.html
   ↓
7. المستخدم يملأ بيانات الموقع ويرفع المستندات
   ↓
8. عند اكتمال التسجيل، يتم توجيهه إلى auth.html
   ↓
9. المستخدم يسجل الدخول ويتم توجيهه للداشبورد المناسب
```

## مسارات الكول باك

تم إعداد مسارات الكول باك التالية في Supabase:

- **تأكيد الإيميل:** `https://luxbyte.vercel.app/email-confirmation.html`
- **إعادة تعيين كلمة المرور:** `https://luxbyte.vercel.app/reset-password.html`
- **نجاح تسجيل الدخول:** `https://luxbyte.vercel.app/auth-success.html`
- **استكمال التسجيل:** `https://luxbyte.vercel.app/complete-registration.html`

## أنواع الحسابات والداشبوردات

| نوع الحساب | مسار الداشبورد | الوصف |
|------------|----------------|--------|
| pharmacy | `dashboard/pharmacy.html` | صيدلية |
| supermarket | `dashboard/supermarket.html` | سوبر ماركت |
| restaurant | `dashboard/restaurant.html` | مطعم |
| clinic | `dashboard/clinic.html` | عيادة |
| courier | `dashboard/courier.html` | سائق توصيل |
| driver | `dashboard/driver.html` | سائق رئيسي |
| admin | `dashboard.html` | إدارة |

## الأمان

### 1. تأكيد الإيميل
- تم تفعيل تأكيد الإيميل في Supabase
- لا يمكن تسجيل الدخول بدون تأكيد الإيميل

### 2. حماية المستندات
- تم إعداد Row Level Security (RLS) للمستندات
- تم إنشاء bucket منفصل للمستندات (`kyc_docs`)
- تم التحقق من صحة الملفات (JPG/PNG فقط)
- تم تحديد حد أقصى لحجم الملفات (5MB)

### 3. حماية الصفحات
- تم إعداد نظام حماية للداشبوردات
- الصفحات العامة لا تحتاج مصادقة
- الصفحات المحمية تتطلب تسجيل دخول

## الملفات الرئيسية

### صفحات HTML
- `simple-signup.html` - صفحة التسجيل المبسطة
- `complete-registration.html` - صفحة استكمال التسجيل
- `email-confirmation.html` - صفحة تأكيد الإيميل
- `reset-password.html` - صفحة إعادة تعيين كلمة المرور
- `auth-success.html` - صفحة نجاح تسجيل الدخول
- `auth.html` - صفحة تسجيل الدخول

### ملفات JavaScript
- `js/auth-config.js` - إعدادات المصادقة ومسارات الكول باك
- `js/auth.js` - دوال المصادقة
- `js/supabase-client.js` - عميل Supabase
- `js/file-upload-manager.js` - مدير رفع الملفات
- `js/guard.js` - نظام حماية الصفحات

### ملفات Supabase
- `supabase/config.toml` - إعدادات Supabase
- `supabase/migrations/` - هجرات قاعدة البيانات

## التثبيت والتشغيل

### 1. متطلبات النظام
- Node.js 18+
- npm أو yarn
- حساب Supabase
- حساب Vercel

### 2. إعداد البيئة
```bash
# استنساخ المشروع
git clone <repository-url>
cd luxbyte

# تثبيت التبعيات
npm install

# إعداد متغيرات البيئة
cp .env.example .env
# قم بتعديل ملف .env بالقيم الصحيحة
```

### 3. إعداد Supabase
```bash
# تسجيل الدخول إلى Supabase
npx supabase login

# ربط المشروع
npx supabase link --project-ref <project-ref>

# تطبيق الهجرات
npx supabase db push
```

### 4. التشغيل المحلي
```bash
# تشغيل الخادم المحلي
npm run dev
```

### 5. النشر
```bash
# نشر إلى Vercel
npm run deploy
```

## الاختبار

### 1. اختبار التسجيل
1. اذهب إلى `simple-signup.html`
2. املأ البيانات وأنشئ حساب
3. تحقق من البريد الإلكتروني
4. افتح رابط التحقق

### 2. اختبار استكمال التسجيل
1. بعد تأكيد الإيميل، اذهب إلى `complete-registration.html`
2. املأ بيانات الموقع
3. ارفع المستندات المطلوبة
4. اضغط "إكمال التسجيل"

### 3. اختبار تسجيل الدخول
1. اذهب إلى `auth.html`
2. سجل الدخول بالبيانات الصحيحة
3. تحقق من التوجيه للداشبورد المناسب

### 4. اختبار إعادة تعيين كلمة المرور
1. من صفحة تسجيل الدخول، اضغط "نسيت كلمة المرور؟"
2. أدخل البريد الإلكتروني
3. تحقق من البريد الإلكتروني
4. افتح رابط إعادة التعيين
5. أدخل كلمة المرور الجديدة

## استكشاف الأخطاء

### 1. مشاكل تأكيد الإيميل
- تحقق من إعدادات Supabase
- تأكد من صحة مسارات الكول باك
- تحقق من إعدادات البريد الإلكتروني

### 2. مشاكل رفع الملفات
- تحقق من إعدادات Storage في Supabase
- تأكد من صحة RLS policies
- تحقق من نوع وحجم الملفات

### 3. مشاكل التوجيه
- تحقق من إعدادات `auth-config.js`
- تأكد من صحة مسارات الداشبورد
- تحقق من بيانات المستخدم في قاعدة البيانات

## الدعم

للحصول على الدعم أو الإبلاغ عن مشاكل:
- أنشئ issue في GitHub
- تواصل مع فريق التطوير
- راجع الوثائق في `docs/`

## الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للتفاصيل.
